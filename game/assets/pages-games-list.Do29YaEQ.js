import{_ as e,h as t,j as s,k as a,l,n as o,r as i,a as r,c as n,w as c,m as u,p as d,q as p,i as m,b as h,t as f,u as y,v as k,o as g,f as w,x as b,y as v,F as C}from"./index-Brgse3E_.js";import{g as _}from"./games.Ds8COotu.js";const x=e({data:()=>({list:[],curTab:{},keyword:"",tabs:[{name:"全部",type:"0"},{name:"闯关",type:"1"},{name:"对战",type:"2"},{name:"射击",type:"3"},{name:"休闲",type:"4"},{name:"RPG",type:"5"},{name:"合卡",type:"6"},{name:"改版",type:"7"}]}),computed:{showList(){return this.list.filter((e=>"0"===this.curTab.type||e.type==this.curTab.type)).filter((e=>!this.keyword||(!!e.name.includes(this.keyword)||(!!e.name.includes(this.keyword.toUpperCase())||!!e.name.includes(this.keyword.toLowerCase())))))}},onLoad(){this.curTab=this.tabs[0];const e=t("games-list")||[];0===e.length?this.loadmore():this.list=e},methods:{clickRab(e){console.log(e),this.curTab=e},leftClick(){console.log("back"),window.parent.postMessage({data:{action:"back"}},"*"),console.log(uni.postMessage),uni.postMessage({data:{action:"back"}})},async check404(e){const t=[];for(let s=0;s<e.length;s+=50){const a=e.slice(s,s+50);await Promise.all(a.map((e=>fetch(e).then((s=>404===s.status&&t.push(e))).catch((()=>{})))))}return t},refresh(){console.log("refresh"),this.keyword="",this.list=[],this.loadmore()},scrolltolower(){},async loadmore(){var e;s({title:"加载中",mask:!0});let t=await _({code:"games-list"});a();JSON.parse(null==(e=t.data)?void 0:e.content).forEach((e=>{if(!e.url)return void console.log(e);this.list.push({url:"https://mp-dd639089-35cb-4e29-a250-f4786c8dcafd.cdn.bspapp.com"+e.url,type:e.type,name:this.trimNumberPrefix(e.url)})})),l("games-list",this.list)},trimNumberPrefix(e){var t,s,a;let l=null==(a=null==(s=null==(t=null==e?void 0:e.split("/"))?void 0:t.pop())?void 0:s.slice(0,-4))?void 0:a.replace(/\s+/g,"").replace(/你妹汉化版/gi,"").replace(/你妹汉化组/gi,"").replace(/你妹联合/gi,""),o=/^\d+\./.test(l)?l.replace(/^\d+\./,""):l;return o=/^\d+\-/.test(o)?o.replace(/^\d+\-/,""):o,o},play(e){l("games-info",e),o({url:"/pages/games/games"})}}},[["render",function(e,t,s,a,l,o){const _=i(r("up-navbar"),u),x=i(r("up-search"),d),T=i(r("u-tabs"),p),L=m,P=i(r("up-cell"),h),j=i(r("up-list-item"),f),M=i(r("u-loadmore"),y),N=i(r("up-list"),k);return g(),n(L,{class:"pages"},{default:c((()=>[w(L,null,{default:c((()=>[w(_,{title:"游戏列表",placeholder:"",onLeftClick:o.leftClick,"left-icon":"",safeAreaInsetTop:!0,autoBack:!1},null,8,["onLeftClick"]),w(x,{placeholder:"搜索游戏",shape:"square",modelValue:l.keyword,"onUpdate:modelValue":t[0]||(t[0]=e=>l.keyword=e),actionText:"刷新",onCustom:o.refresh},null,8,["modelValue","onCustom"]),w(T,{list:l.tabs,onClick:o.clickRab},null,8,["list","onClick"])])),_:1}),w(L,{style:{flex:"1",overflow:"hidden"}},{default:c((()=>[w(N,{style:{height:"100%"},onScrolltolower:o.scrolltolower},{default:c((()=>[(g(!0),b(C,null,v(o.showList,((e,t)=>(g(),n(j,{key:t},{default:c((()=>[w(P,{title:`${t+1}、`+e.name,onClick:t=>o.play(e)},null,8,["title","onClick"])])),_:2},1024)))),128)),w(M,{status:"nomore"})])),_:1},8,["onScrolltolower"])])),_:1})])),_:1})}],["__scopeId","data-v-49572704"]]);export{x as default};
