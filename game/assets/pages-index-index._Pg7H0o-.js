import{s as t,d as e,_ as s,n as a,r as o,a as i,c as n,w as l,i as c,b as p,e as u,o as r,f as d,g as h}from"./index-BaYpiEvH.js";import{g as m}from"./games.Ds8COotu.js";class f{constructor(){return f.ins||(f.ins=this),this.packageInfo={},this.canUpdate=!1,this.isDownload=!1,this.version=uni.$u.sys().appVersionCode,this.init(),f.ins}init(){}async checkNewVersion(){const t=await m({code:"games-version"}),e=JSON.parse(t.data.content);this.packageInfo=e,this.version<this.packageInfo.version&&(this.canUpdate=!0)}showDia(){this.canUpdate&&t({title:"提示",content:"有新版本，是否下载更新？",showCancel:!0,success:({confirm:t,cancel:e})=>{t&&(this.isDownload=!0,this.downloadFile(this.packageInfo.url))}})}downloadFile(t){return new Promise(((s,a)=>{e({url:t,success:t=>{200===t.statusCode&&(console.log("下载成功",t),console.log("下载成功"),this.installApp(t.tempFilePath),s(t.tempFilePath))},fail:t=>{this.isDownload=!1,a(new Error(`下载失败：code:${t};`))}})}))}installApp(e){plus.runtime.install(e,{force:!1},(e=>{this.isDownload=!1,t({title:"提示",content:"APP升级完成，重新启动立即体验最新版本",confirmText:"立即重启",showCancel:!1,success:({confirm:t})=>{t&&this.restartApp()}})}),(t=>{this.isDownload=!1,console.log(t)}))}restartApp(){setTimeout((()=>{plus.runtime.restart()}),500)}}const g=s({data:()=>({updateInfo:{}}),computed:{versionVal(){let t=this.updateInfo.version;return this.updateInfo.isDownload?"下载中":this.updateInfo.canUpdate?"有新版本 "+this.updateInfo.packageInfo.version:t}},onReady(){new f,setTimeout((()=>{this.updateInfo=new f}),200)},methods:{toOther(){a({url:"/pages/webview/webview?url=https://ljhym.github.io/blog/#/pages/games/games"})},toGames(){a({url:"/pages/webview/webview?url=https://static-mp-dd639089-35cb-4e29-a250-f4786c8dcafd.next.bspapp.com/game/#/pages/games/list"})},resetApp(){var t;null==(t=null==plus?void 0:plus.runtime)||t.restart()},outApp(){var t;null==(t=null==plus?void 0:plus.runtime)||t.quit()},checkUpdate(){this.updateInfo.init(),this.updateInfo.showDia(),this.$forceUpdate()}}},[["render",function(t,e,s,a,m,f){const g=h,w=c,v=o(i("up-cell"),p),k=o(i("up-cell-group"),u);return r(),n(w,null,{default:l((()=>[d(w,{class:"about__logobox"},{default:l((()=>[d(g,{class:"about__logobox__img",src:"/game/assets/app-logo-BMqUaTnw.png",mode:"widthFix"})])),_:1}),d(k,null,{default:l((()=>[d(v,{title:"游戏",onClick:f.toGames},null,8,["onClick"]),d(v,{title:"其他",onClick:f.toOther},null,8,["onClick"]),d(v,{title:"检查更新",onClick:f.checkUpdate,value:f.versionVal},null,8,["onClick","value"]),d(v,{title:"重启软件",onClick:f.resetApp},null,8,["onClick"]),d(v,{title:"退出软件",onClick:f.outApp},null,8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-783e1a52"]]);export{g as default};
