import{s as e,d as t,_ as s,n as a,r as o,a as i,c as n,w as l,i as r,b as c,e as p,o as u,f as d,g as h}from"./index-DhJ4nWep.js";import{g as m}from"./games.Ds8COotu.js";class g{constructor(){return g.ins||(g.ins=this),this.packageInfo={},this.canUpdate=!1,this.isDownload=!1,this.version=uni.$u.sys().appVersionCode,this.init(),g.ins}init(){}async checkNewVersion(){const e=await m({code:"games-version"}),t=JSON.parse(e.data.content);this.packageInfo=t,this.version<this.packageInfo.version&&(this.canUpdate=!0)}showDia(){this.canUpdate&&e({title:"提示",content:"有新版本，是否下载更新？",showCancel:!0,success:({confirm:e,cancel:t})=>{e&&(this.isDownload=!0,this.downloadFile(this.packageInfo.url))}})}downloadFile(e){return new Promise(((s,a)=>{t({url:e,success:e=>{200===e.statusCode&&(console.log("下载成功",e),console.log("下载成功"),this.installApp(e.tempFilePath),s(e.tempFilePath))},fail:e=>{this.isDownload=!1,a(new Error(`下载失败：code:${e};`))}})}))}installApp(t){plus.runtime.install(t,{force:!1},(t=>{this.isDownload=!1,e({title:"提示",content:"APP升级完成，重新启动立即体验最新版本",confirmText:"立即重启",showCancel:!1,success:({confirm:e})=>{e&&this.restartApp()}})}),(e=>{this.isDownload=!1,console.log(e)}))}restartApp(){setTimeout((()=>{plus.runtime.restart()}),500)}}const w=s({data:()=>({updateInfo:{}}),computed:{versionVal(){let e=this.updateInfo.version;return this.updateInfo.isDownload?"下载中":this.updateInfo.canUpdate?"有新版本 "+this.updateInfo.packageInfo.version:e}},onLoad(e){},onReady(){var e;e="landscape",new Promise(((t,s)=>{if(screen.orientation&&screen.orientation.lock){let a;switch(e){case"landscape":a=screen.orientation.lock("landscape");break;case"portrait":default:a=screen.orientation.lock("portrait");break;case"auto":return screen.orientation.unlock(),void t()}a.then((()=>{t()})).catch((e=>{s(new Error("H5端锁定屏幕方向失败: "+e.message))}))}else s(new Error("当前浏览器不支持屏幕方向锁定"))})),new g,setTimeout((()=>{this.updateInfo=new g}),200)},methods:{toOther(){a({url:"/pages/webview/webview?url=https://ljhym.github.io/blog/#/pages/games/games"})},toGames(e="",t){a({url:"/pages/webview/webview?url=https://static-mp-dd639089-35cb-4e29-a250-f4786c8dcafd.next.bspapp.com/game/#/pages/games/list?emulator="+t+"&local="+e})},toGames2(){a({url:"/pages/webview/webview?url=https://ljhym.github.io/example/game/#/pages/games/list"})},toLocal(e,t=""){a({url:"/pages/games/list?local="+e+"&emulator="+t})},resetApp(){var e;null==(e=null==plus?void 0:plus.runtime)||e.restart()},outApp(){var e;null==(e=null==plus?void 0:plus.runtime)||e.quit()},checkUpdate(){this.updateInfo.init(),this.updateInfo.showDia(),this.$forceUpdate()}}},[["render",function(e,t,s,a,m,g){const w=h,f=r,k=o(i("up-cell"),c),v=o(i("up-cell-group"),p);return u(),n(f,null,{default:l((()=>[d(f,{class:"about__logobox"},{default:l((()=>[d(w,{class:"about__logobox__img",src:"/example/game/assets/app-logo-BMqUaTnw.png",mode:"widthFix"})])),_:1}),d(v,null,{default:l((()=>[d(k,{title:"游戏",onClick:t[0]||(t[0]=e=>g.toGames("",""))}),d(k,{title:"emulator",onClick:t[1]||(t[1]=e=>g.toGames("",1))}),d(k,{title:"游戏(备用)",onClick:g.toGames2},null,8,["onClick"]),d(k,{title:"检查更新",onClick:g.checkUpdate,value:g.versionVal},null,8,["onClick","value"]),d(k,{title:"重启软件",onClick:g.resetApp},null,8,["onClick"]),d(k,{title:"退出软件",onClick:g.outApp},null,8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-335af93a"]]);export{w as default};
