import{_ as e,h as t,j as l,k as a,l as s,C as o,m as i,n as r,r as n,a as u,c,w as d,p as m,q as p,t as h,i as y,b as f,u as w,v as g,x as b,o as k,f as v,y as C,z as x,F as _}from"./index-DhJ4nWep.js";import{g as T}from"./games.Ds8COotu.js";const L=e({data:()=>({list:[],curTab:{},keyword:"",tabs:[{name:"闯关",type:"1"},{name:"对战",type:"2"},{name:"射击",type:"3"},{name:"休闲",type:"4"},{name:"RPG",type:"5"},{name:"合卡",type:"6"},{name:"改版",type:"7"},{name:"其他1",type:"8"},{name:"其他2",type:"9"}],type:"",emulator:""}),computed:{showList(){return this.list.filter((e=>!!this.curTab.type&&e.type==this.curTab.type)).filter((e=>!this.keyword||(!!e.name.includes(this.keyword)||(!!e.name.includes(this.keyword.toUpperCase())||!!e.name.includes(this.keyword.toLowerCase())))))}},onLoad(e){e.local&&(this.local=e.local),e.emulator&&(this.emulator=e.emulator),this.curTab=this.tabs[0];const l=t("games-list")||[];0===l.length?this.loadmore():this.list=l},methods:{clickRab(e){console.log(e),this.curTab=e},leftClick(){var e;null==(e=null==uni?void 0:uni.webView)||e.postMessage({data:{action:"back"}}),l()},async check404(e){const t=[];for(let l=0;l<e.length;l+=50){const a=e.slice(l,l+50);await Promise.all(a.map((e=>fetch(e).then((l=>404===l.status&&t.push(e))).catch((()=>{})))))}return t},refresh(){console.log("refresh"),this.keyword="",this.list=[],this.loadmore()},scrolltolower(){},async loadmore(){var e;a({title:"加载中",mask:!0});let t=await T({code:"games-list"});s();JSON.parse(null==(e=t.data)?void 0:e.content).forEach((e=>{e.url?this.list.push({url:o.VITE_UPLOAD_BASE+e.url,type:e.type,name:this.trimNumberPrefix(e.url)}):console.log(e)})),i("games-list",this.list)},trimNumberPrefix(e){var t,l,a;let s=null==(a=null==(l=null==(t=null==e?void 0:e.split("/"))?void 0:t.pop())?void 0:l.slice(0,-4))?void 0:a.replace(/\s+/g,"").replace(/你妹汉化版/gi,"").replace(/你妹汉化组/gi,"").replace(/你妹联合/gi,""),o=/^\d+\./.test(s)?s.replace(/^\d+\./,""):s;return o=/^\d+\-/.test(o)?o.replace(/^\d+\-/,""):o,o},play(e){return i("games-info",e),this.local?1==this.emulator?void r({url:"/pages/webview/webview?url=/hybrid/html/index.html?rom="+e.url}):void r({url:"/pages/games/games"}):1==this.emulator?void r({url:"/pages/webview/webview?url=https://static-mp-dd639089-35cb-4e29-a250-f4786c8dcafd.next.bspapp.com/emulator/index.html?rom="+e.url}):void r({url:"/pages/games/games"})}}},[["render",function(e,t,l,a,s,o){const i=n(u("up-navbar"),m),r=n(u("up-search"),p),T=n(u("u-tabs"),h),L=y,P=n(u("up-cell"),f),V=n(u("up-list-item"),w),S=n(u("u-loadmore"),g),j=n(u("up-list"),b);return k(),c(L,{class:"pages"},{default:d((()=>[v(L,null,{default:d((()=>[v(i,{title:"游戏列表",placeholder:"",onLeftClick:o.leftClick,safeAreaInsetTop:!0,autoBack:!1},null,8,["onLeftClick"]),v(r,{placeholder:"搜索游戏",shape:"square",modelValue:s.keyword,"onUpdate:modelValue":t[0]||(t[0]=e=>s.keyword=e),actionText:"刷新",onCustom:o.refresh},null,8,["modelValue","onCustom"]),v(T,{list:s.tabs,onClick:o.clickRab},null,8,["list","onClick"])])),_:1}),v(L,{style:{flex:"1",overflow:"hidden"}},{default:d((()=>[v(j,{style:{height:"100%"},onScrolltolower:o.scrolltolower},{default:d((()=>[(k(!0),C(_,null,x(o.showList,((e,t)=>(k(),c(V,{key:t},{default:d((()=>[v(P,{title:`${t+1}、`+e.name,onClick:t=>o.play(e)},null,8,["title","onClick"])])),_:2},1024)))),128)),v(S,{status:"nomore"})])),_:1},8,["onScrolltolower"])])),_:1})])),_:1})}],["__scopeId","data-v-8381d926"]]);export{L as default};
