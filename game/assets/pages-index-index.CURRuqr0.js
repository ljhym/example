import{s as e,d as t,_ as s,n as a,r as o,a as i,c as l,w as n,i as p,b as c,e as u,o as r,f as d,g as h}from"./index-EYZk6_JY.js";import{g as m}from"./games.Ds8COotu.js";class g{constructor(){return g.ins||(g.ins=this),this.packageInfo={},this.canUpdate=!1,this.isDownload=!1,this.version=uni.$u.sys().appVersionCode,this.init(),g.ins}init(){}async checkNewVersion(){const e=await m({code:"games-version"}),t=JSON.parse(e.data.content);this.packageInfo=t,this.version<this.packageInfo.version&&(this.canUpdate=!0)}showDia(){this.canUpdate&&e({title:"提示",content:"有新版本，是否下载更新？",showCancel:!0,success:({confirm:e,cancel:t})=>{e&&(this.isDownload=!0,this.downloadFile(this.packageInfo.url))}})}downloadFile(e){return new Promise(((s,a)=>{t({url:e,success:e=>{200===e.statusCode&&(console.log("下载成功",e),console.log("下载成功"),this.installApp(e.tempFilePath),s(e.tempFilePath))},fail:e=>{this.isDownload=!1,a(new Error(`下载失败：code:${e};`))}})}))}installApp(t){plus.runtime.install(t,{force:!1},(t=>{this.isDownload=!1,e({title:"提示",content:"APP升级完成，重新启动立即体验最新版本",confirmText:"立即重启",showCancel:!1,success:({confirm:e})=>{e&&this.restartApp()}})}),(e=>{this.isDownload=!1,console.log(e)}))}restartApp(){setTimeout((()=>{plus.runtime.restart()}),500)}}const w=s({data:()=>({updateInfo:{}}),computed:{versionVal(){let e=this.updateInfo.version;return this.updateInfo.isDownload?"下载中":this.updateInfo.canUpdate?"有新版本 "+this.updateInfo.packageInfo.version:e}},onReady(){new g,setTimeout((()=>{this.updateInfo=new g}),200)},methods:{toOther(){a({url:"/pages/webview/webview?url=https://ljhym.github.io/blog/#/pages/games/games"})},toGames(){a({url:"/pages/webview/webview?url=https://static-mp-dd639089-35cb-4e29-a250-f4786c8dcafd.next.bspapp.com/game/#/pages/games/list"})},toGames2(){a({url:"/pages/webview/webview?url=https://ljhym.github.io/example/game/#/pages/games/list"})},resetApp(){var e;null==(e=null==plus?void 0:plus.runtime)||e.restart()},outApp(){var e;null==(e=null==plus?void 0:plus.runtime)||e.quit()},checkUpdate(){this.updateInfo.init(),this.updateInfo.showDia(),this.$forceUpdate()}}},[["render",function(e,t,s,a,m,g){const w=h,f=p,v=o(i("up-cell"),c),k=o(i("up-cell-group"),u);return r(),l(f,null,{default:n((()=>[d(f,{class:"about__logobox"},{default:n((()=>[d(w,{class:"about__logobox__img",src:"/example/game/assets/app-logo-BMqUaTnw.png",mode:"widthFix"})])),_:1}),d(k,null,{default:n((()=>[d(v,{title:"游戏",onClick:g.toGames},null,8,["onClick"]),d(v,{title:"游戏(备用)",onClick:g.toGames2},null,8,["onClick"]),d(v,{title:"其他",onClick:g.toOther},null,8,["onClick"]),d(v,{title:"检查更新",onClick:g.checkUpdate,value:g.versionVal},null,8,["onClick","value"]),d(v,{title:"重启软件",onClick:g.resetApp},null,8,["onClick"]),d(v,{title:"退出软件",onClick:g.outApp},null,8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-6d576ea2"]]);export{w as default};
