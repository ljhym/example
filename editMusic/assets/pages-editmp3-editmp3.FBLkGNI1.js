import{m as e,a as t,o as n,c as a,n as o,i,d as l,w as r,b as s,e as u,f as h,t as c,g as d,r as f,h as g,u as m,j as p,k as b,F as y,l as w,I as B,p as C}from"./index-DktYEIPP.js";import{_ as v}from"./_plugin-vue_export-helper.BCo6x5W8.js";function k(e,t){return"string"==typeof e?t:e}const T=v({name:"u-gap",mixins:[e,t,{props:{bgColor:{type:String,default:()=>uni.$u.props.gap.bgColor},height:{type:[String,Number],default:()=>uni.$u.props.gap.height},marginTop:{type:[String,Number],default:()=>uni.$u.props.gap.marginTop},marginBottom:{type:[String,Number],default:()=>uni.$u.props.gap.marginBottom}}}],computed:{gapStyle(){const e={backgroundColor:this.bgColor,height:uni.$u.addUnit(this.height),marginTop:uni.$u.addUnit(this.marginTop),marginBottom:uni.$u.addUnit(this.marginBottom)};return uni.$u.deepMerge(e,uni.$u.addStyle(this.customStyle))}}},[["render",function(e,t,l,r,s,u){const h=i;return n(),a(h,{class:"u-gap",style:o([u.gapStyle])},null,8,["style"])}],["__scopeId","data-v-ef5cc2d5"]]);const _=v(l({components:{},props:{value:{type:Array,default:function(){return[0,100]}},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},format:{type:Function,default:function(e){return e}},disabled:{type:Boolean,default:!1},height:{height:Number,default:50},barHeight:{type:Number,default:5},backgroundColor:{type:String,default:"#e9e9e9"},activeColor:{type:String,default:"#1aad19"},blockSize:{type:Number,default:20},blockColor:{type:String,default:"#fff"},tipVisible:{type:Boolean,default:!0},decorationVisible:{type:Boolean,default:!1}},data(){return{values:[this.min,this.max],startDragPos:0,startVal:0}},computed:{lowerHandlePosition(){return(this.values[0]-this.min)/(this.max-this.min)*100},higherHandlePosition(){return(this.values[1]-this.min)/(this.max-this.min)*100},lowerTipStyle(){return this.lowerHandlePosition<90?`left: ${this.lowerHandlePosition}%;`:`right: ${100-this.lowerHandlePosition}%;transform: translate(50%, -100%);`},higherTipStyle(){return this.higherHandlePosition<90?`left: ${this.higherHandlePosition}%;`:`right: ${100-this.higherHandlePosition}%;transform: translate(50%, -100%);`}},created:function(){},onLoad:function(e){},watch:{value:{immediate:!0,handler(e,t){!this._isValuesValid(e)||e[0]===this.values[0]&&e[1]===this.values[1]||this._updateValue(e)}}},methods:{_updateValue(e){if(this.step>=this.max-this.min)throw new RangeError("Invalid slider step or slider range");let t=[];Array.isArray(e)&&(t=[e[0],e[1]]),"number"!=typeof t[0]?t[0]=this.values[0]:t[0]=Math.round((t[0]-this.min)/this.step)*this.step+this.min,"number"!=typeof t[1]?t[1]=this.values[1]:t[1]=Math.round((t[1]-this.min)/this.step)*this.step+this.min,this.values[0]===t[0]&&this.values[1]===t[1]||(t[0]<this.min&&(t[0]=this.min),t[1]>this.max&&(t[1]=this.max),t[0]>=t[1]&&(t[0]===this.values[0]?t[1]=t[0]+this.step:t[0]=t[1]-this.step),this.values=t,this.$emit("change",this.values))},_onTouchStart:function(e){if(this.disabled)return;this.isDragging=!0;let t=e.target.dataset.tag,n=e.changedTouches?e.changedTouches[0]:e;this.startDragPos=n.pageX,this.startVal="lowerBlock"===t?this.values[0]:this.values[1]},_onBlockTouchMove:function(e){this.disabled||this._onDrag(e)},_onBlockTouchEnd:function(e){this.disabled||(this.isDragging=!1,this._onDrag(e))},_onDrag(e){if(!this.isDragging)return;uni.createSelectorQuery().in(this).select(".slider-range-inner").boundingClientRect((t=>{let n=t.width;const a=e.target.dataset.tag;let o=((e.changedTouches?e.changedTouches[0]:e).pageX-this.startDragPos)/n*(this.max-this.min),i=this.startVal+o;"lowerBlock"===a?this._updateValue([i,null]):this._updateValue([null,i])})).exec()},_isValuesValid:function(e){return Array.isArray(e)&&2==e.length}}}),[["render",function(e,t,l,f,g,m){const p=i;return n(),a(p,{class:u(["slider-range",{disabled:e.disabled}]),style:o({paddingLeft:e.blockSize/2+"px",paddingRight:e.blockSize/2+"px"})},{default:r((()=>[s(p,{class:"slider-range-inner",style:o({height:e.height+"px"})},{default:r((()=>[s(p,{class:"slider-bar",style:o({height:e.barHeight+"px"})},{default:r((()=>[s(p,{class:"slider-bar-bg",style:o({backgroundColor:e.backgroundColor})},null,8,["style"]),s(p,{class:"slider-bar-inner",style:o({width:(e.values[1]-e.values[0])/(e.max-e.min)*100+"%",left:e.lowerHandlePosition+"%",backgroundColor:e.activeColor})},null,8,["style"])])),_:1},8,["style"]),s(p,{class:u(["slider-handle-block",{decoration:e.decorationVisible}]),style:o({backgroundColor:e.blockColor,width:e.blockSize+"px",height:e.blockSize+"px",left:e.lowerHandlePosition+"%"}),onTouchstart:e._onTouchStart,onTouchmove:e._onBlockTouchMove,onTouchend:e._onBlockTouchEnd,"data-tag":"lowerBlock"},null,8,["class","style","onTouchstart","onTouchmove","onTouchend"]),s(p,{class:u(["slider-handle-block",{decoration:e.decorationVisible}]),style:o({backgroundColor:e.blockColor,width:e.blockSize+"px",height:e.blockSize+"px",left:e.higherHandlePosition+"%"}),onTouchstart:e._onTouchStart,onTouchmove:e._onBlockTouchMove,onTouchend:e._onBlockTouchEnd,"data-tag":"higherBlock"},null,8,["class","style","onTouchstart","onTouchmove","onTouchend"]),e.tipVisible?(n(),a(p,{key:0,class:"range-tip",style:o(e.lowerTipStyle)},{default:r((()=>[h(c(e.format(e.values[0])),1)])),_:1},8,["style"])):d("",!0),e.tipVisible?(n(),a(p,{key:1,class:"range-tip",style:o(e.higherTipStyle)},{default:r((()=>[h(c(e.format(e.values[1])),1)])),_:1},8,["style"])):d("",!0)])),_:1},8,["style"])])),_:1},8,["class","style"])}],["__scopeId","data-v-0c3be6d5"]]),E=v({__name:"editmp3",setup(e){const t=new AudioContext,o=f({barHeight:3,blockSize:26,backgroundColor:"#EEEEF6",offsetTime:10,list:[{src:"https://www.miniui.top/music/%E5%83%8F%E6%88%91%E8%BF%99%E6%A0%B7%E7%9A%84%E4%BA%BA(Live)-%E6%AF%9B%E4%B8%8D%E6%98%93-27485797.mp3",id:1,buffer:"",time:0,volume:1,croppingTime:0,rangeValue:[0,0],audioBuffer:"",newAudioBuffer:""},{src:"https://www.miniui.top/music/%E6%98%9F%E6%98%9F%E7%82%B9%E7%81%AF-%E9%83%91%E6%99%BA%E5%8C%96-158919.mp3",id:2,buffer:"",time:0,volume:.9,croppingTime:0,rangeValue:[0,0],audioBuffer:"",newAudioBuffer:""},{src:"https://www.miniui.top/music/%E5%B9%B3%E5%87%A1%E4%B9%8B%E8%B7%AF.mp3",id:3,buffer:"",time:0,volume:1,croppingTime:0,rangeValue:[0,0],newAudioBuffer:""},{src:"https://www.miniui.top/music/%E5%A4%9C%E6%9B%B2-%E5%91%A8%E6%9D%B0%E4%BC%A6-118980.mp3",id:4,buffer:"",time:0,volume:1,croppingTime:0,rangeValue:[0,0],newAudioBuffer:""}],progress:"0%",blob:"",filename:""});function l(e){return Number(e).toFixed(1)+"S"}function u(e,t){o.list[t].rangeValue=e,function(e){let t=o.list[e];o.list[e].croppingTime=t.rangeValue[1]-t.rangeValue[0]}(t)}async function v(e){let n=await async function(e,t){const n=await fetch(e);if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);console.log(n.headers);const a=n.headers.get("Content-Length");if(!a)throw new Error("Unable to determine file size");const o=parseInt(a,10);let i=0;const l=n.body.getReader(),r=new ReadableStream({start(e){!function n(){l.read().then((({done:a,value:l})=>{a?e.close():(i+=l.byteLength,t(i/o),e.enqueue(l),n())}))}()}});return new Response(r).arrayBuffer()}(e.src,(e=>{console.log(`Progress: ${Math.round(100*e)}%`),o.progress=Math.round(100*e)+"%"})).then((e=>e));console.log(n);let a=await(i=n,console.log(i),new Promise((e=>{t.decodeAudioData(i,(function(t){e(t)}))})));var i;console.log(a),o.list.forEach((t=>{t.id==e.id&&(t.buffer=n,t.audioBuffer=a,t.time=a.duration,t.rangeValue=[0,a.duration],t.croppingTime=a.duration-t.rangeValue[0])})),console.log(o.list)}async function E(){o.list.forEach((e=>{console.log(e),e.audioBuffer&&V(e.audioBuffer,e.rangeValue,e.volume)}))}function V(e,t=[0,0],n=1){const a=new AudioContext,o=a.createBufferSource(),i=a.createGain();console.log(Number(n)),i.gain.value=Number(n),o.connect(i),i.connect(a.destination),o.buffer=e,o.start(0,t[0]),o.stop(t[1]-t[0])}async function S(){o.list.forEach((e=>{e.audioBuffer&&(e.newAudioBuffer=function(e){let n=e.audioBuffer,a=n.numberOfChannels,o=n.sampleRate,i=e.rangeValue[0]*o,l=e.rangeValue[1]*o-i;console.log(l);let r=t.createBuffer(a,l,o),s=new Float32Array(l),u=0;for(let t=0;t<a;t++)n.copyFromChannel(s,t,i),r.copyToChannel(s,t,u);return r}(e))})),o.list.forEach((e=>{e.newAudioBuffer&&(e.newAudioBuffer=function(e){const t=e.volume;let n=null,a=e.newAudioBuffer;n=new AudioBuffer({length:a.length,numberOfChannels:a.numberOfChannels,sampleRate:a.sampleRate});for(let o=0;o<a.numberOfChannels;o+=1){const e=a.getChannelData(o),i=n.getChannelData(o);for(let n=0;n<e.length;n+=1)i[n]=e[n]*t}return n}(e))}));let e=o.list.map((e=>e.newAudioBuffer)).filter((e=>e));if(2===e.length){let n=await async function(e,n){if(2!==e.length)throw new Error("This function only supports merging two buffers.");let a=e[0],o=e[1],i=a.sampleRate,l=n*i,r=l+o.length,s=Math.max(a.numberOfChannels,o.numberOfChannels),u=t.createBuffer(s,r,i);for(let t=0;t<s;t++){const e=u.getChannelData(t),n=a.getChannelData(t);for(let o=a.getChannelData(t).length-1;o>=0;o--)e[o]+=n[o];u.getChannelData(t).set(e,0)}for(let t=0;t<s;t++){const e=u.getChannelData(t),n=o.getChannelData(t);for(let a=o.getChannelData(t).length-1;a>=0;a--)e[a+l]+=n[a];u.getChannelData(t).set(e,0)}return u}(e,o.offsetTime);if(console.log("Merged AudioBuffer:",n),n){V(n,[0,n.duration],1);const e=function(e,t){var n,a,o=e.numberOfChannels,i=t*o*2+44,l=new ArrayBuffer(i),r=new DataView(l),s=[],u=0,h=0;for(d(1179011410),d(i-8),d(1163280727),d(544501094),d(16),c(1),c(o),d(e.sampleRate),d(2*e.sampleRate*o),c(2*o),c(16),d(1635017060),d(i-h-4),n=0;n<e.numberOfChannels;n++)s.push(e.getChannelData(n));for(;h<i;){for(n=0;n<o;n++)a=0|(.5+(a=Math.max(-1,Math.min(1,s[n][u])))<0?32768*a:32767*a),r.setInt16(h,a,!0),h+=2;u++}return new Blob([l],{type:"audio/wav"});function c(e){r.setUint16(h,e,!0),h+=2}function d(e){r.setUint32(h,e,!0),h+=4}}(n,n.length);return o.blob=e,void(o.filename="merged.mp3")}}}function A(){const e=URL.createObjectURL(o.blob);let t=document.createElement("a");t.style.display="none",t.href=e,t.download=o.filename,document.body.appendChild(t),t.click(),URL.revokeObjectURL(e)}return(e,t)=>{const f=w,x=B,D=k(g("u-gap"),T),P=i,H=C,R=k(g("slider-range"),_);return n(),a(P,null,{default:r((()=>[s(f,{onClick:E},{default:r((()=>[h("试听播放")])),_:1}),s(f,{style:{color:"red"}},{default:r((()=>[h("加载进度："+c(m(o).progress),1)])),_:1}),h(" 偏移时间 "),s(x,{type:"number",modelValue:m(o).offsetTime,"onUpdate:modelValue":t[0]||(t[0]=e=>m(o).offsetTime=e),name:"",id:""},null,8,["modelValue"]),h(" 播放第一个音频后 "+c(m(o).offsetTime)+" 秒开始播放第二个音频 ",1),s(D,{height:"30"}),(n(!0),p(y,null,b(m(o).list,((e,t)=>(n(),a(P,{key:t,class:"item"},{default:r((()=>[s(P,{onClick:t=>v(e)},{default:r((()=>[h(c(e),1)])),_:2},1032,["onClick"]),h(" 音频总时长："+c(e.time)+"S ",1),s(P,null,{default:r((()=>[s(H,null,{default:r((()=>[h("裁剪时长："+c(e.rangeValue[1]-e.rangeValue[0])+"S",1)])),_:2},1024),s(P,{class:"slider-item"},{default:r((()=>[s(R,{value:e.rangeValue,min:0,max:e.time,step:.1,"bar-height":m(o).barHeight,"block-size":m(o).blockSize,"background-color":m(o).backgroundColor,format:l,onChange:e=>u(e,t)},null,8,["value","max","bar-height","block-size","background-color","onChange"])])),_:2},1024)])),_:2},1024),h(" 音量(0-1)："),s(x,{type:"number",style:{color:"red"},modelValue:e.volume,"onUpdate:modelValue":t=>e.volume=t},null,8,["modelValue","onUpdate:modelValue"]),s(f,{onClick:t=>function(e){V(e.audioBuffer,e.rangeValue,e.volume)}(e)},{default:r((()=>[h("试听当前裁剪")])),_:2},1032,["onClick"]),s(D,{height:"50"})])),_:2},1024)))),128)),s(f,{onClick:S},{default:r((()=>[h("保存")])),_:1}),m(o).blob?(n(),a(f,{key:0,onClick:A},{default:r((()=>[h("下载")])),_:1})):d("",!0)])),_:1})}}},[["__scopeId","data-v-076e9f07"]]);export{E as default};
