var E=Object.defineProperty,I=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var b=(s,t,e)=>t in s?E(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,M=(s,t)=>{for(var e in t||(t={}))R.call(t,e)&&b(s,e,t[e]);if(y)for(var e of y(t))B.call(t,e)&&b(s,e,t[e]);return s},C=(s,t)=>I(s,A(t));import{B as W}from"./index.618e76e4.js";import{Z as z,u as H,s as O,q as T,n as G,o as l,b as h,c as N,g as F,a as i,B as m,f as u,h as g,F as w,A as f,z as P,p as j,d as D,y as x,w as k,_ as V}from"./vendor.d2fb6949.js";import{L as $}from"./Loading.79f752f4.js";import{g as q}from"./index.8e92a03d.js";import{C as Y,S as Z,P as J,l as K,aG as Q,j as U,aH as X,aI as ee}from"./three.module.99621659.js";import{R as te}from"./rgbeloader.41105168.js";import{O as se}from"./orbitcontrols.af7a7f0c.js";import{G as ie}from"./GLTFLoader.195d9604.js";import{_ as ne}from"./index.ef2301ac.js";import{S as oe,R as re,a as ae}from"./SketchOutlined.8fd85801.js";import"./request.7b4fbf82.js";class de{constructor(t,e){this.container=document.querySelector(t),this.camera,this.scene,this.renderer,this.panzi,this.model,this.mixer,this.onFinish=e,this.clock=new Y,this.init(),this.animate(),this.progressFn}init(){this.initSence(),this.initCamera(),this.initRender(),this.addMesh(),window.addEventListener("resize",this.onWindowResize.bind(this)),this.container.addEventListener("mousewheel",this.onMouseWheel.bind(this))}initSence(){this.scene=new Z,this.setEnvMap("000")}initCamera(){this.camera=new J(45,window.innerWidth/window.innerHeight,.2,200),this.camera.position.set(-1.8,.6,2.7)}initRender(){this.renderer=new K({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.toneMapping=Q,this.renderer.toneMappingExposure=2,this.container.appendChild(this.renderer.domElement)}setEnvMap(t){new te().setPath("./files/hdr/").load(t+".hdr",e=>{e.mapping=U,this.scene.background=e,this.scene.environment=e})}render(){var t=this.clock.getDelta();this.mixer&&this.mixer.update(t),this.renderer.render(this.scene,this.camera)}animate(){this.renderer.setAnimationLoop(this.render.bind(this))}initControls(){this.controls=new se(this.camera,this.renderer.domElement)}setModel(t){return new Promise((e,p)=>{new ie().setPath("files/gltf/").load(t,n=>{this.model&&this.model.removeFromParent(),this.model=n.scene.children[0],this.scene.add(this.model),t=="bag2.glb"&&!this.panzi&&(this.scene.add(n.scene),this.camera=n.cameras[0],this.mixer=new X(n.scene.children[0]),this.animateAction=this.mixer.clipAction(n.animations[0]),this.animateAction.setDuration(20).setLoop(ee),this.animateAction.clampWhenFinished=!0,this.spotlight1=n.scene.children[2].children[0],this.spotlight1.intensity=1,this.spotlight2=n.scene.children[3].children[0],this.spotlight2.intensity=1,this.spotlight3=n.scene.children[1].children[0],this.spotlight3.intensity=1),e(n)},n=>{this.progressFn&&this.progressFn(n)})})}onProgress(t){this.progressFn=t}async addMesh(){let t=await this.setModel("bag2.glb");this.onFinish&&this.onFinish(t)}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}onMouseWheel(t){let e=t.deltaY>0?1:-1;this.animateAction.setEffectiveTimeScale(e),this.animateAction.paused=!1,this.animateAction.play(),this.timeoutid&&clearTimeout(this.timeoutid),this.timeoutid=setTimeout(()=>{this.animateAction.halt(.5)},300)}}const ce=s=>(j("data-v-6081465d"),s=s(),D(),s),le={class:"product"},he=P("\u4EA7\u54C1\u63A8\u8350 "),me={class:"products"},ue=["onClick"],pe={class:"prod-title"},_e={class:"img"},ge=["src"],we=P(" \u52A0\u5165\u8D2D\u7269\u8F66 "),ve=ce(()=>i("div",{class:"fix"},"\u9F20\u6807\u4E0A\u4E0B\u6EDA\u52A8",-1)),fe={class:"title"},xe={class:"content"},Pe=P("\u5207\u6362\u4F7F\u7528\u573A\u666F "),ye={class:"scenes"},be=["onClick"],Me=["src"],Ce={__name:"Product2",setup(s){const t=z();H();const e=O({products:[],screen:[],pIndex:0,sceneIndex:0,base3d:{},descIndex:0,isLoading:!0,Progress:0});function p(){e.isLoading=!1}let v=T();async function n(d,r){e.pIndex=r,e.isLoading=!0,e.Progress=0;let c=await e.base3d.setModel(d.modelName);console.log(c),p()}function L(d,r){e.sceneIndex=r,e.base3d.setEnvMap(d)}function S(d){let r=C(M({},d),{num:1}),c=0;t.state.buycarts.some((a,_)=>r.id==a.id?(c=_,!0):!1)?t.commit("addBuycartsNum",c):t.commit("addBuycarts",r)}return G(async()=>{let d=await q();console.log(d),e.products=d.list,e.screen=d.hdr,v.value.addEventListener("mousewheel",r=>{r.deltaY>0?t.commit("setFullscreen",!0):t.commit("setFullscreen",!1);let c=e.base3d.animateAction._clip.duration,o=e.base3d.animateAction.time,a=Math.floor(o/c*4);e.descIndex=a}),e.base3d=new de("#product",p),e.base3d.onProgress(r=>{e.Progress=((r.loaded/r.total-0)*100).toFixed(2),console.log(e.Progress),e.Progress=="100.00"&&p()})}),(d,r)=>{const c=W;return l(),h(w,null,[e.isLoading?(l(),N($,{key:0,text:"3D\u6A21\u578B\u52A0\u8F7D\u8F83\u6162",Progress:e.Progress},null,8,["Progress"])):F("",!0),i("div",le,[i("div",{class:m(["prod-list",{hidden:u(t).state.isFullscreen}])},[i("h1",null,[g(u(oe)),he]),i("div",me,[(l(!0),h(w,null,f(e.products,(o,a)=>(l(),h("div",{class:m(["prod-item",{active:a==e.pIndex}]),onClick:_=>n(o,a)},[i("div",pe,x(o.title),1),i("div",_e,[i("img",{src:o.imgsrc,alt:""},null,8,ge)]),g(c,{block:"",type:"primary",onClick:V(_=>S(o),["stop"])},{icon:k(()=>[g(u(ae))]),default:k(()=>[we]),_:2},1032,["onClick"])],10,ue))),256))])],2),i("div",{ref_key:"product",ref:v,id:"product"},[ve,e.products[e.descIndex]?(l(!0),h(w,{key:0},f(e.products[e.descIndex].desc,(o,a)=>(l(),h("div",{class:m(["desc-list",{active:e.descIndex==a}])},[i("h1",fe,x(o.title),1),i("p",xe,x(o.content),1)],2))),256)):F("",!0)],512),i("div",{class:m(["scene-list",{hidden:u(t).state.isFullscreen}])},[i("h3",null,[g(u(re)),Pe]),i("div",ye,[(l(!0),h(w,null,f(e.screen,(o,a)=>(l(),h("div",{class:m(["scene-item",{active:a==e.sceneIndex}]),onClick:_=>L(o,a)},[i("img",{src:`./files/hdr/${o}.jpg`,alt:""},null,8,Me)],10,be))),256))])],2)])],64)}}};var Oe=ne(Ce,[["__scopeId","data-v-6081465d"]]);export{Oe as default};
