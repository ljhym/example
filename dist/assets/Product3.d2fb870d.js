var E=Object.defineProperty,B=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var L=(i,t,e)=>t in i?E(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,k=(i,t)=>{for(var e in t||(t={}))z.call(t,e)&&L(i,e,t[e]);if(S)for(var e of S(t))j.call(t,e)&&L(i,e,t[e]);return i},M=(i,t)=>B(i,T(t));import{B as W}from"./index.618e76e4.js";import{Z as N,u as A,s as G,q as H,n as O,o as l,b as p,c as q,g as I,a as r,B as _,f as w,h as x,F,A as C,z as y,p as V,d as $,y as b,w as R,_ as D}from"./vendor.d2fb6949.js";import{L as U}from"./Loading.79f752f4.js";import{g as Y}from"./index.8e92a03d.js";import{C as Z,S as J,j as K,P as Q,l as X,aG as ee,A as te,T as se,R as h,N as g}from"./three.module.99621659.js";import{R as ie}from"./rgbeloader.41105168.js";import{O as ne}from"./orbitcontrols.af7a7f0c.js";import{G as re}from"./GLTFLoader.195d9604.js";import{_ as oe}from"./index.ef2301ac.js";import{S as ae,R as de,a as ce}from"./SketchOutlined.8fd85801.js";import"./request.7b4fbf82.js";class le{constructor(t,e){this.container=document.querySelector(t),this.camera,this.scene,this.renderer,this.panzi,this.model,this.mixer,this.onFinish=e,this.clock=new Z,this.init(),this.progressFn}init(){this.initSence(),this.initCamera(),this.initRender(),this.initControls(),this.render(),this.addMesh(),this.setLight(),window.addEventListener("resize",this.onWindowResize.bind(this))}initSence(){this.scene=new J,this.setEnvMap("000")}setEnvMap(t){new ie().setPath("./files/hdr/").load(t+".hdr",e=>{e.mapping=K,this.scene.background=e,this.scene.environment=e})}initCamera(){this.camera=new Q(45,window.innerWidth/window.innerHeight,.2,200),this.camera.position.set(-1.8,1.6,2.7)}initRender(){this.renderer=new X({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.toneMapping=ee,this.renderer.toneMappingExposure=2,this.container.appendChild(this.renderer.domElement),this.renderer.setClearColor("#ffffff",1)}initControls(){this.controls=new ne(this.camera,this.renderer.domElement),this.controls.enableDamping=!0}render(){requestAnimationFrame(this.render.bind(this)),this.renderer.render(this.scene,this.camera)}setLight(){const t=new te(16777215,.5);this.scene.add(t)}setModel(t){return new Promise((e,f)=>{new re().setPath("files/gltf/").load(t,d=>{this.model&&this.model.removeFromParent(),this.model=d.scene.children[0];const m=new se,u=m.load("./wenli/wl3.jpg"),n=m.load("./wenli/wl2.jpg"),s=m.load("./wenli/wl3.jpg"),o=m.load("./wenli/wl4.jpg");u.wrapS=h,u.wrapT=h,n.wrapS=h,n.wrapT=h,s.wrapS=h,s.wrapT=h,o.wrapS=h,o.wrapT=h,s.minFilter=g,s.magFilter=g,o.minFilter=g,o.magFilter=g,n.minFilter=g,n.magFilter=g,this.model.children[2].material.map=u,this.model.children[2].material.needsUpdate=!0,this.model.children[2].material.alphaTest=.1,this.model.children[1].material.map=u,this.model.children[1].material.needsUpdate=!0,console.log(this.model),this.scene.add(this.model),t=="bag2.glb"&&!this.panzi&&(this.scene.add(d.scene),this.spotlight1=d.scene.children[2].children[0],this.spotlight1.intensity=1,this.spotlight2=d.scene.children[3].children[0],this.spotlight2.intensity=1,this.spotlight3=d.scene.children[1].children[0],this.spotlight3.intensity=1),e(d)},d=>{this.progressFn&&this.progressFn(d)})})}onProgress(t){this.progressFn=t}async addMesh(){let t=await this.setModel("shoes.glb");this.onFinish&&this.onFinish(t)}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}}const he=i=>(V("data-v-4be69f50"),i=i(),$(),i),pe={class:"product"},me=y("\u4EA7\u54C1\u63A8\u8350 "),ue={class:"products"},ge=["onClick"],_e={class:"prod-title"},we={class:"img"},fe=["src"],ve=y(" \u52A0\u5165\u8D2D\u7269\u8F66 "),xe=he(()=>r("div",{class:"fix"},"\u9F20\u6807\u4E0A\u4E0B\u6EDA\u52A8",-1)),Fe={class:"title"},Pe={class:"content"},Ce=y("\u5207\u6362\u4F7F\u7528\u573A\u666F "),be={class:"scenes"},ye=["onClick"],Se=["src"],Le={__name:"Product3",setup(i){const t=N();A();const e=G({products:[],screen:[],pIndex:0,pIndex:1,sceneIndex:0,base3d:{},descIndex:0,isLoading:!0,Progress:0});function f(){e.isLoading=!1}let P=H();async function d(n,s){e.pIndex=s,e.isLoading=!0,e.Progress=0;let o=await e.base3d.setModel(n.modelName);console.log(o),f()}function m(n,s){e.sceneIndex=s,e.base3d.setEnvMap(n)}function u(n){let s=M(k({},n),{num:1}),o=0;t.state.buycarts.some((c,v)=>s.id==c.id?(o=v,!0):!1)?t.commit("addBuycartsNum",o):t.commit("addBuycarts",s)}return O(async()=>{let n=await Y();console.log(n),e.products=n.list,e.screen=n.hdr,P.value.addEventListener("mousewheel",s=>{s.deltaY>0?t.commit("setFullscreen",!0):t.commit("setFullscreen",!1)}),e.base3d=new le("#product",f),e.base3d.onProgress(s=>{e.Progress=((s.loaded/s.total-0)*100).toFixed(2),console.log(e.Progress),e.Progress=="100.00"&&f()})}),(n,s)=>{const o=W;return l(),p(F,null,[e.isLoading?(l(),q(U,{key:0,text:"3D\u6A21\u578B\u52A0\u8F7D\u8F83\u6162",Progress:e.Progress},null,8,["Progress"])):I("",!0),r("div",pe,[r("div",{class:_(["prod-list",{hidden:w(t).state.isFullscreen}])},[r("h1",null,[x(w(ae)),me]),r("div",ue,[(l(!0),p(F,null,C(e.products,(a,c)=>(l(),p("div",{class:_(["prod-item",{active:c==e.pIndex}]),onClick:v=>d(a,c)},[r("div",_e,b(a.title),1),r("div",we,[r("img",{src:a.imgsrc,alt:""},null,8,fe)]),x(o,{block:"",type:"primary",onClick:D(v=>u(a),["stop"])},{icon:R(()=>[x(w(ce))]),default:R(()=>[ve]),_:2},1032,["onClick"])],10,ge))),256))])],2),r("div",{ref_key:"product",ref:P,id:"product"},[xe,e.products[e.descIndex]?(l(!0),p(F,{key:0},C(e.products[e.descIndex].desc,(a,c)=>(l(),p("div",{class:_(["desc-list",{active:e.descIndex==c}])},[r("h1",Fe,b(a.title),1),r("p",Pe,b(a.content),1)],2))),256)):I("",!0)],512),r("div",{class:_(["scene-list",{hidden:w(t).state.isFullscreen}])},[r("h3",null,[x(w(de)),Ce]),r("div",be,[(l(!0),p(F,null,C(e.screen,(a,c)=>(l(),p("div",{class:_(["scene-item",{active:c==e.sceneIndex}]),onClick:v=>m(a,c)},[r("img",{src:`./files/hdr/${a}.jpg`,alt:""},null,8,Se)],10,ye))),256))])],2)])],64)}}};var Ge=oe(Le,[["__scopeId","data-v-4be69f50"]]);export{Ge as default};
